---
import Layout from "@/layouts/Layout.astro";
import ServicePageClient from "@/components/pages/ServicePageClient";
import { services, siteConfig } from "@/config/site";
import { getProjectsByService } from "@/data";

export async function getStaticPaths() {
    return services.map((service) => ({
        params: { slug: service.slug },
        props: { service },
    }));
}

const { service } = Astro.props;
const projects = getProjectsByService(service.id).slice(0, 6);

const title = `${service.nameAr} | خدمات مسار للتسويق`;
const description = `${service.descriptionAr} - خدمة ${service.nameAr} in السعودية. أسعار تنافسية تبدأ من ${service.priceFrom} ${service.currency}. ضمان 30 يوم + دعم فني 24/7.`;

// JSON-LD for Service and Breadcrumbs
const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        {
            "@type": "ListItem",
            position: 1,
            name: "الرئيسية",
            item: siteConfig.url,
        },
        {
            "@type": "ListItem",
            position: 2,
            name: "الخدمات",
            item: `${siteConfig.url}/services`,
        },
        {
            "@type": "ListItem",
            position: 3,
            name: service.nameAr,
            item: `${siteConfig.url}/services/${service.slug}`,
        },
    ],
};

const serviceSchema = {
    "@context": "https://schema.org",
    "@type": "Service",
    "@id": `${siteConfig.url}/services/${service.slug}#service`,
    name: service.nameAr,
    description: service.descriptionAr,
    provider: {
        "@type": "Organization",
        "@id": `${siteConfig.url}/#organization`,
    },
    areaServed: siteConfig.cities.map((city) => ({
        "@type": "City",
        name: city.nameAr,
    })),
    offers: {
        "@type": "Offer",
        price: service.priceFrom,
        priceCurrency: "SAR",
        priceValidUntil: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000)
            .toISOString()
            .split("T")[0],
        availability: "https://schema.org/InStock",
    },
    serviceType: service.nameAr,
};
---

<Layout title={title} description={description}>
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />
    <script
        type="application/ld+json"
        set:html={JSON.stringify(serviceSchema)}
    />
    <ServicePageClient service={service} projects={projects} client:load />
</Layout>
